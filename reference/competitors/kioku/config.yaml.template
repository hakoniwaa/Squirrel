# Kioku v2.0 Configuration
# Copy this to .context/config.yaml and customize as needed

# Storage configuration
storage:
  contextDir: ".context"
  dbPath: ".context/sessions.db"
  chromaPath: ".context/chroma"

# Embeddings configuration
embeddings:
  provider: "openai"
  model: "text-embedding-3-small"
  apiKey: "${OPENAI_API_KEY}"
  batchSize: 100

# Background services
services:
  scorerInterval: 300000        # 5 minutes
  prunerThreshold: 0.8          # 80% capacity
  sessionTimeout: 3600000       # 1 hour
  embeddingsInterval: 10000     # 10 seconds

# Context window management
contextWindow:
  maxTokens: 100000
  pruneTarget: 80000

# Logging
logging:
  level: "info"                 # debug | info | warn | error
  file: ".context/kioku.log"

# v2.0 Features

# Smart Chunking (AST-based code parsing)
chunking:
  enabled: true
  minLines: 5
  maxLines: 300
  contextLines: 3               # Lines before/after chunk
  maxNestingDepth: 3
  fallbackToFile: true          # Fallback to file-level on parse errors

# File Watcher (Real-time context updates)
file_watcher:
  enabled: true
  debounceMs: 400               # Wait for file stability
  pollIntervalMs: 100
  ignored:
    - "node_modules"
    - ".git"
    - "dist"
    - "build"
    - "coverage"
    - ".next"
    - ".nuxt"

# Git Integration
git:
  enabled: true
  maxCommitsPerLog: 100
  diffMaxFiles: 50

# AI-Enhanced Discovery (Requires ANTHROPIC_API_KEY)
ai_discovery:
  enabled: false                # Set to true when API key is configured
  provider: "anthropic"
  model: "claude-3-sonnet-20240229"
  confidenceThreshold: 0.6      # Only accept discoveries >= 0.6 confidence
  maxMessagesPerSession: 50
  costLimitPerDay: 10.0         # USD

# Intelligent Ranking
ranking:
  recencyWeight: 1.5            # 24h boost
  recencyWeekWeight: 1.2        # 7d boost
  moduleWeight: 1.3             # Same module boost
  frequencyDivisor: 100         # access_count / 100
  frequencyCap: 1.5

# Multi-Project Support
multi_project:
  enabled: false
  maxLinkedProjects: 10
  searchDepth: 1                # Levels of transitive links

# Monitoring & Metrics
monitoring:
  metricsEnabled: true
  metricsPort: 9090
  healthCheckEnabled: true
  cacheMetricsTTL: 1000         # Milliseconds

# Dashboard (Visual context inspection)
dashboard:
  enabled: false
  port: 3456
  autoOpenBrowser: true
  pollInterval: 5000            # Milliseconds
