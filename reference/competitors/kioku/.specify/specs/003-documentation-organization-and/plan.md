# Implementation Plan: Documentation Organization and Monorepo Restructure

**Branch**: `003-documentation-organization-and` | **Date**: 2025-10-11 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `.specify/specs/003-documentation-organization-and/spec.md`

**Note**: This plan defines the technical approach for restructuring Kioku into a monorepo with organized documentation.

## Summary

This feature reorganizes the Kioku project to improve developer experience through:
1. **Documentation consolidation**: Move markdown files from root to `docs/` folder with flat structure and descriptive kebab-case naming
2. **Monorepo structure**: Split codebase into four packages (cli, api, ui, shared) to enable independent development and clear boundaries
3. **Workspace configuration**: Use Bun workspaces for dependency management across packages

**Technical Approach**: File-based reorganization first (docs), followed by code migration to packages with automated import path updates, preserving all existing functionality through comprehensive testing.

## Technical Context

**Language/Version**: TypeScript 5.x with Bun 1.0+ runtime  
**Primary Dependencies**: 
- Bun workspaces (monorepo management)
- TypeScript compiler
- Existing project dependencies (preserved per package)

**Storage**: File system (markdown files, source code) - no database changes  
**Testing**: Vitest (existing test framework, 90% coverage requirement maintained)  
**Target Platform**: macOS/Linux development environment (Node.js/Bun compatible)  
**Project Type**: Monorepo (transitioning from single project to multi-package)  

**Performance Goals**: 
- Individual package builds: <5 seconds (SC-008)
- File moves: Complete in <2 minutes for ~500 files
- Import path updates: Automated, zero manual intervention

**Constraints**: 
- Must preserve ALL existing functionality (SC-005: zero regressions)
- Must maintain 90% test coverage requirement
- Must use Bun workspaces (no Nx/Turborepo/Lerna per out-of-scope)
- Cannot refactor code logic (only move and organize)

**Scale/Scope**: 
- 8 markdown files to reorganize
- ~500 source files across src/, tests/, types/ directories  
- 4 packages to create (cli, api, ui, shared)
- Import path updates across entire codebase

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle 1: Transparency First
**Status**: ✅ PASS  
**Reasoning**: This restructure improves transparency - documentation will be easier to find in centralized `docs/` folder, and package boundaries make code organization visible.

### Principle 2: Zero Manual Intervention
**Status**: ✅ PASS  
**Reasoning**: Restructure is a one-time setup task. Once complete, the monorepo structure requires no additional manual intervention for daily development.

### Principle 3: Progressive Intelligence  
**Status**: ✅ PASS  
**Reasoning**: Not directly applicable to this restructure. Existing context management features preserved.

###Principle 4: Smart Resource Management
**Status**: ✅ PASS  
**Reasoning**: Not directly applicable. No changes to context window management or pruning logic.

### Principle 5: Simplicity Over Features
**Status**: ⚠️ REVIEW REQUIRED  
**Reasoning**: This adds complexity (monorepo structure) but provides **essential foundation** for:
- Independent package development (enables team scaling)
- Clear architectural boundaries (prevents coupling)
- Organized documentation (improves onboarding)

**Justification**: Monorepo is NOT feature creep - it's architectural foundation for maintainability as project grows. Without it, managing CLI/API/UI as single codebase becomes unmaintainable.

### Overall Gate Status: ✅ CONDITIONAL PASS

**Conditions**:
1. Must maintain simplicity within packages (no over-engineering)
2. Must use native Bun workspaces only (no complex tooling)
3. Must preserve existing functionality (no feature additions during restructure)

## Project Structure

### Documentation (this feature)

```
.specify/specs/003-documentation-organization-and/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (in progress)
├── research.md          # Phase 0: Technical research and decisions
├── data-model.md        # Phase 1: File mapping and package structure
├── quickstart.md        # Phase 1: Step-by-step migration guide
├── checklists/
│   └── requirements.md  # Quality validation (completed)
└── tasks.md             # Phase 2: Generated by /speckit.tasks command
```

### Source Code (repository root)

**Current Structure** (single project):
```
kioku/
├── src/                          # All source code
│   ├── domain/                   # Business logic
│   ├── application/              # Use cases
│   └── infrastructure/
│       ├── cli/                  # CLI commands
│       ├── mcp/                  # MCP server
│       ├── storage/              # Database/files
│       └── background/           # Services
├── tests/                        # All tests
├── types/                        # TypeScript types
├── dashboard/                    # Web UI
├── README.md                     # Root readme
├── CLAUDE.md                     # AI dev guide
├── SETUP_GUIDE.md               # Setup docs
├── CHANGELOG.md                  # Changelog
├── (other .md files)             # Scattered docs
└── package.json                  # Single package
```

**Target Structure** (monorepo):
```
kioku/
├── packages/
│   ├── cli/
│   │   ├── src/
│   │   │   ├── commands/         # From src/infrastructure/cli/commands/
│   │   │   ├── utils/            # CLI-specific utilities
│   │   │   └── index.ts          # CLI entry point
│   │   ├── tests/                # CLI tests
│   │   ├── package.json          # CLI dependencies
│   │   └── README.md             # CLI package docs
│   │
│   ├── api/
│   │   ├── src/
│   │   │   ├── domain/           # From src/domain/
│   │   │   ├── application/      # From src/application/
│   │   │   ├── infrastructure/   # From src/infrastructure/{mcp,storage,background}/
│   │   │   └── index.ts          # API entry point
│   │   ├── tests/                # API tests
│   │   ├── package.json          # API dependencies
│   │   └── README.md             # API package docs
│   │
│   ├── ui/
│   │   ├── src/                  # From dashboard/
│   │   ├── public/               # Static assets
│   │   ├── tests/                # UI tests
│   │   ├── package.json          # UI dependencies
│   │   └── README.md             # UI package docs
│   │
│   └── shared/
│       ├── src/
│       │   ├── types/            # From types/ + shared types
│       │   ├── utils/            # Shared utilities
│       │   └── constants/        # Shared constants
│       ├── tests/                # Shared tests
│       ├── package.json          # Shared dependencies
│       └── README.md             # Shared package docs
│
├── docs/
│   ├── setup-guide.md            # From SETUP_GUIDE.md
│   ├── changelog.md              # From CHANGELOG.md
│   ├── project-overview.md       # From kioku.md
│   ├── research.md               # From research.md
│   ├── merge-readiness.md        # From MERGE_READINESS.md
│   └── future-features.md        # From FUTURE_FEATURES.md
│
├── .specify/                     # Spec-driven development (unchanged)
├── README.md                     # Root readme (stays, updated)
├── CLAUDE.md                     # AI dev guide (stays, updated)
├── package.json                  # Root workspace config
├── bun.lockb                     # Workspace lockfile
└── bunfig.toml                   # Bun configuration
```

**Structure Decision**: Using **monorepo with packages** structure because:
1. Kioku has distinct concerns: CLI tool, MCP API server, Web dashboard
2. Enables independent development and testing per package
3. Allows clear dependency boundaries (shared code in packages/shared)
4. Aligns with modern TypeScript monorepo patterns (Bun workspaces)

## Complexity Tracking

No complexity violations detected. Constitution check passed with conditions (see above).
